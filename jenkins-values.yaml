controller:
  # התיקון: חזרה למבנה של אובייקט (כמו שהצ'ארט דורש)
  image:
    registry: "docker.io"
    repository: "jenkins/jenkins"
    tag: "lts"
  
  # משאבים מותאמים
  resources:
    requests:
      cpu: "500m"
      memory: "1024Mi"
    limits:
      cpu: "2000m"
      memory: "2048Mi"

  # --- התיקון הקבוע לשגיאת ה-403 (Crumb/CSRF) ---
  # הוספנו בסוף השורה את הפקודה שמבטלת את החסימה באופן קבוע
  javaOpts: "-Xms1024m -Xmx1536m -Dhudson.security.csrf.GlobalCrumbIssuerConfiguration.DISABLE_CSRF_PROTECTION=true"

  # תיקון הרשאות לדיסק (קריטי למניעת קריסה של ה-Init)
  runAsUser: 1000
  fsGroup: 1000
  
  # תיקון סבלנות (מונע Restart Loop בעלייה)
  probes:
    startup:
      enabled: true
      failureThreshold: 30
      periodSeconds: 10
    liveness:
      enabled: true
      initialDelaySeconds: 120
      failureThreshold: 5
    readiness:
      enabled: true
      initialDelaySeconds: 60
      failureThreshold: 5

  serviceType: LoadBalancer
  servicePort: 8080

  persistence:
    enabled: true
    size: "8Gi"
    storageClass: "gp3"
    accessMode: ReadWriteOnce

  # פלאגינים בגרסת latest למניעת שגיאות 404
  installPlugins:
    - kubernetes:latest
    - workflow-aggregator:latest
    - git:latest
    - configuration-as-code:latest

serviceAccount:
  create: true
  name: jenkins

rbac:
  create: true
  readSecrets: true